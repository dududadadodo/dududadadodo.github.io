<!DOCTYPE html>

<html class="no-js" lang="">

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>ISOMETRIC CITY TEST</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta name="description" content="" />
    <meta 
     name='viewport' 
     content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' 
/>
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
    <link rel="stylesheet" href="css/normalize.min.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Prompt:300,400,700"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/main.css" />
  </head>
  <body>
    <div class="zoom-contrl">
      <div class="zoom-out">
        OUT
      </div>
      <div class="zoom-in">
        IN
      </div>
      <div class="viewbox"></div>
    </div>
    <div class="container">
    <div id="isomatric-city">
      <?xml version="1.0" encoding="utf-8"?>
      <svg version="1.1" id="Layer_1"   width="949.9"
      height="748.5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
         viewBox="0 0 1385.7 864.2" style="enable-background:new 0 0 1385.7 864.2;" xml:space="preserve">

         <defs>
          <style>
            .cls-1 {
              fill: #eaeaea;
            }
            .cls-2 {
              fill: #1767aa;
            }
            .cls-3 {
              fill: #1a8dff;
            }
            .cls-4 {
              fill: #9ad4fc;
            }
            .cls-5 {
              fill: #fff;
            }
          </style>
          <g id="ground">
            <polygon
              class="cls-1"
              points="1247 384.1 1385.6 464.1 1247.1 544.1 1108.5 464.1 1247 384.1"
            />
            <polygon
              class="cls-1"
              points="1108.5 304.1 1247.1 384.1 1108.5 464.1 969.9 384.1 1108.5 304.1"
            />
            <polygon
              class="cls-1"
              points="969.9 224.1 1108.5 304.2 970 384.1 831.4 304.1 969.9 224.1"
            />
            <polygon
              class="cls-1"
              points="831.4 144.1 970 224.2 831.5 304.2 692.9 224.1 831.4 144.1"
            />
            <polygon
              class="cls-1"
              points="692.9 64.2 831.5 144.2 692.9 224.2 554.3 144.1 692.9 64.2"
            />
            <polygon
              class="cls-1"
              points="1108.5 464.1 1247.1 544.1 1108.6 624.1 970 544.1 1108.5 464.1"
            />
            <polygon
              class="cls-1"
              points="970 384.1 1108.6 464.1 970 544.1 831.4 464.1 970 384.1"
            />
            <polygon
              class="cls-1"
              points="831.4 304.1 970 384.1 831.5 464.1 692.9 384.1 831.4 304.1"
            />
            <polygon
              class="cls-1"
              points="692.9 224.1 831.5 304.1 693 384.1 554.4 304.1 692.9 224.1"
            />
            <polygon
              class="cls-1"
              points="554.4 144.1 693 224.1 554.4 304.1 415.8 224.1 554.4 144.1"
            />
            <polygon
              class="cls-1"
              points="970 544.1 1108.6 624.1 970.1 704.1 831.5 624.1 970 544.1"
            />
            <polygon
              class="cls-1"
              points="831.5 464.1 970.1 544.1 831.5 624.1 692.9 544.1 831.5 464.1"
            />
            <polygon
              class="cls-1"
              points="692.9 384.1 831.5 464.1 693 544.1 554.4 464.1 692.9 384.1"
            />
            <polygon
              class="cls-1"
              points="554.4 304.1 693 384.1 554.5 464.1 415.9 384.1 554.4 304.1"
            />
            <polygon
              class="cls-1"
              points="415.9 224.1 554.5 304.1 415.9 384.1 277.3 304.1 415.9 224.1"
            />
            <polygon
              class="cls-1"
              points="831.5 624 970.1 704.1 831.5 784 693 704 831.5 624"
            />
            <polygon
              class="cls-1"
              points="693 544 831.5 624.1 693 704.1 554.4 624 693 544"
            />
            <polygon
              class="cls-1"
              points="554.4 464.1 693 544.1 554.5 624.1 415.9 544 554.4 464.1"
            />
            <polygon
              class="cls-1"
              points="415.9 384.1 554.5 464.1 415.9 544.1 277.4 464.1 415.9 384.1"
            />
            <polygon
              class="cls-1"
              points="277.4 304.1 415.9 384.1 277.4 464.1 138.8 384.1 277.4 304.1"
            />
            <polygon
              class="cls-1"
              points="693 704 831.6 784 693 864 554.5 784 693 704"
            />
            <polygon
              class="cls-1"
              points="554.5 624 693 704 554.5 784 415.9 704 554.5 624"
            />
            <polygon
              class="cls-1"
              points="415.9 544 554.5 624.1 416 704 277.4 624 415.9 544"
            />
            <polygon
              class="cls-1"
              points="277.4 464 416 544.1 277.4 624.1 138.8 544 277.4 464"
            />
            <polygon
              class="cls-1"
              points="138.8 384 277.4 464.1 138.9 544.1 0.3 464 138.8 384"
            />
          </g>
        </defs>
        <title>text</title>
        <g id="objects">
        <use xlink:href="#ground" x="15" y="15" transform="scale(1, 1)"/> 
        <use xlink:href="#ground" x="670" y="395" transform="scale(1, 1)"/>
        </g>
      </svg>
      
      
    </div>
<!--     <div id="isomatric-property">
      d
    </div> -->
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
    <script src="js/main.js"></script>
    <script>
      var svg = document.querySelector("svg");
      var zoomin = document.querySelector(".zoom-in");
      var zoomout = document.querySelector(".zoom-out");
      var scale = 1;
      var svgSize = {width: svg.clientWidth, height: svg.clientHeight};
      // var sidebar = document.getElementById("isomatric-property");
      var isPointerDown = false;
      var pointerOrigin = {
        x: 0,
        y: 0,
      };

      var viewBox = {
        x: 0,
        y: 0,
        width: 1000,
        height: window.screen.height,
      };

      var newViewBox = {
        x: 0,
        y: 0,
      };

      function getPointFromEvent(event) {
        var point = { x: 0, y: 0 };
        if (event.targetTouches) {
          point.x = event.targetTouches[0].clientX;
          point.y = event.targetTouches[0].clientY;
        } else {
          point.x = event.clientX;
          point.y = event.clientY;
        }
        return point;
      }


      function onPointerMove(event) {
        if (!isPointerDown) {
          return;
        }
        event.preventDefault();

        var pointerPosition = getPointFromEvent(event);

        newViewBox.x = viewBox.x - (pointerPosition.x - pointerOrigin.x);
        newViewBox.y = viewBox.y - (pointerPosition.y - pointerOrigin.y);

        var viewBoxString = `${newViewBox.x * scale} ${newViewBox.y * scale} ${viewBox.width} ${viewBox.height}`;
        svg.setAttribute("viewBox", viewBoxString);
        document.querySelector(".viewbox").innerHTML = viewBoxString;
      }
      function onPointerDown(event) {
        isPointerDown = true;
        var pointerPosition = getPointFromEvent(event);
        pointerOrigin.x = pointerPosition.x;
        pointerOrigin.y = pointerPosition.y;
      }

      function onPointerUp() {
        isPointerDown = false;
        viewBox.x = newViewBox.x;
        viewBox.y = newViewBox.y;
      }
      function onWheel(e){
        var w = viewBox.width;
        var h = viewBox.height;
        var mx = e.offsetX;
        var my = e.offsetY;
        var dw = w * Math.sign(e.deltaY) * 0.05;
        var dh = h * Math.sign(e.deltaY) * 0.05;
        var dx = dw * mx / svgSize.width;
        var dy = dh * my / svgSize.height;
        viewBox.x = viewBox.x + dx;
        viewBox.y = viewBox.y + dy;
        viewBox.width = viewBox.width - dw;
        viewBox.height = viewBox.height - dy;
        setViewPort(viewBox.x, viewBox.y, viewBox.width, viewBox.height);
        scale = svgSize.width / viewBox.width;

      }
      if (window.PointerEvent) {
        svg.addEventListener("pointerdown", onPointerDown); 
        svg.addEventListener("pointerup", onPointerUp);
        svg.addEventListener("pointerleave", onPointerUp);
        svg.addEventListener("pointermove", onPointerMove);
        svg.addEventListener("wheel", onWheel);
      } else {
        svg.addEventListener("mousedown", onPointerDown); 
        svg.addEventListener("mouseup", onPointerUp); 
        svg.addEventListener("mouseleave", onPointerUp);
        svg.addEventListener("mousemove", onPointerMove);
        svg.addEventListener("touchstart", onPointerDown); 
        svg.addEventListener("touchend", onPointerUp); 
        svg.addEventListener("touchmove", onPointerMove);
        svg.addEventListener("wheel", onWheel);
      }

      function setViewPort(x, y, width = viewBox.width, height = viewBox.height) {
        var viewBoxString = `${x} ${y} ${width} ${height}`;
        svg.setAttribute("viewBox", viewBoxString);
        document.querySelector(".viewbox").innerHTML = viewBoxString;
      }

      function onZoomIn() {
        viewBox.x = viewBox.x + viewBox.width / 4;
        viewBox.y = viewBox.y + viewBox.height / 4;
        viewBox.width = viewBox.width / 2;
        viewBox.height = viewBox.height / 2;
        setViewPort(viewBox.x, viewBox.y);
      }
      function onZoomOut() {
        viewBox.x = viewBox.x - viewBox.width / 2;
        viewBox.y = viewBox.y - viewBox.height / 2;
        viewBox.width = viewBox.width * 2;
        viewBox.height = viewBox.height * 2;
        setViewPort(viewBox.x, viewBox.y);
      }


  
      function getMessage(e){
          let data = JSON.parse(e.data)
          if(data.name == "address"){
            if(document.getElementById("addresscustom")){
              document.getElementById("addresscustom").innerHTML = data.value
            }
            else {
              var obj = document.getElementById("address");
              let box = obj.getBBox();
              let text = document.createElementNS("http://www.w3.org/2000/svg", "text");
              text.innerHTML = data.value;
              text.setAttribute("id", "addresscustom")
              text.setAttribute("x", box.x)
              text.setAttribute("y", box.y)
              text.setAttribute("transform", "skewY(30)")
              document.getElementById("addresstext").appendChild(text)
            }
          }
      }
      function handle(e) {
        var obj = e.currentTarget;
        let box = obj.getBBox();
        let x = box.x + box.width / 2;
        let y = box.y + box.height / 2;
        let vx = x - viewBox.width / 2 ;
        let vy = y -  viewBox.height / 2;
        setViewPort(vx, vy);
        if(window.ReactNativeWebView && obj.id)
        window.ReactNativeWebView.postMessage(obj.id)

        // if(!sidebar.classList.contains("show"))
        // document.getElementById("isomatric-property").classList.toggle("show");
      }
      if(window.ReactNativeWebView){
        window.addEventListener("message", getMessage, false)
      }
      zoomin.addEventListener("click", onZoomIn);
      zoomout.addEventListener("click", onZoomOut);
      let buildings = document.querySelectorAll(".building");
      buildings.forEach((e) => e.addEventListener("click", handle, false));
    </script>
  </body>
</html>
